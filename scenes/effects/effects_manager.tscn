[gd_scene load_steps=5 format=1]

[ext_resource path="res://art/weapons/bullet.png" type="Texture" id=1]
[ext_resource path="res://sound/Western-Gunshot.smp" type="Sample" id=2]

[sub_resource type="GDScript" id=1]

script/source = "extends KinematicBody2D\n\n#Player reference\nvar player = null\nvar sample_player = null\n\n#State tracking\nvar emit_bullet_trail = false\nvar emitting = false\nvar shot_start = null\nvar shot_end = null\nvar total_shot_distance = null\nvar remaining_shot_distance = null\n\nfunc _enter_tree():\n\tset_process(true)\n\tplayer = global.player\n\tplayer.connect(\"shot_fired\", self, \"on_player_shot_fired\")\n\tsample_player = get_node(\"sample_player\")\n\nfunc _process(delta):\n\n\tif (emitting):\n\t\tremaining_shot_distance = get_pos().distance_to(shot_end)\n\t\tif (remaining_shot_distance > 5):\n\t\t\tvar speed_ratio = total_shot_distance/remaining_shot_distance\n\t\t\tmove((shot_end - get_pos()) * delta * 3 * speed_ratio)\n\t\telse:\n\t\t\temitting = false\n\t\t\tget_node(\"sprite\").set_hidden(true)\n\n\tif (emit_bullet_trail):\n\t\tmove_to(shot_start)\n\t\tget_node(\"sprite\").set_hidden(false)\n\t\temitting = true\n\t\temit_bullet_trail = false\n\t\ttotal_shot_distance = shot_start.distance_to(shot_end)\n\n\t\t#Rotate the sprite to point at the shot end location\n\t\tlook_at(shot_end)\n\nfunc on_player_shot_fired(start, end, victim):\n\tsample_player.play(\"gunshot\", 2)\n\temit_bullet_trail = true\n\tshot_start = start\n\tshot_end = end"

[sub_resource type="SampleLibrary" id=2]

samples/gunshot = { "db":0.0, "pitch":1.0, "sample":ExtResource( 2 ) }

[node name="root" type="Node2D"]

[node name="bullet" type="KinematicBody2D" parent="."]

input/pickable = false
collision/layers = 1
collision/mask = 1
collision/margin = 0.08
script/script = SubResource( 1 )

[node name="sprite" type="Sprite" parent="bullet"]

transform/rot = 90.0
texture = ExtResource( 1 )

[node name="sample_player" type="SamplePlayer2D" parent="bullet"]

params/volume_db = 0.0
params/pitch_scale = 1.0
params/attenuation/min_distance = 1.0
params/attenuation/max_distance = 2048.0
params/attenuation/distance_exp = 1.0
config/polyphony = 1
config/samples = SubResource( 2 )
config/pitch_random = 0.0


